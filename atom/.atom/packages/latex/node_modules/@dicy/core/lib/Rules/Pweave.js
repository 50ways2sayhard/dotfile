'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _set = require('babel-runtime/core-js/set');

var _set2 = _interopRequireDefault(_set);

var _Rule = require('../Rule');

var _Rule2 = _interopRequireDefault(_Rule);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Pweave extends _Rule2.default {

  constructCommand() {
    const cacheDirectory = this.options.pweaveCacheDirectory;
    const figureDirectory = this.options.pweaveFigureDirectory;
    const kernel = this.options.pweaveKernel;
    const outputPath = this.options.pweaveOutputPath;
    // Always add output format and output path.
    const args = ['pweave', `--format=${this.options.pweaveOutputFormat}`, `--output={{${outputPath}}}`];

    // If the cache directory is not the default then set it.
    if (cacheDirectory !== 'cache') {
      args.push(`--cache-directory={{${cacheDirectory}}}`);
    }

    // If the figure directory is not the default then set it.
    if (figureDirectory !== 'figures') {
      args.push(`--figure-directory={{${figureDirectory}}}`);
    }

    if (kernel !== 'python3') {
      args.push(`--kernel=${kernel}`);
    }

    // Add the documentation mode option if it is set.
    if (this.options.pweaveDocumentationMode) {
      args.push('--documentation-mode');
    }

    args.push('{{$FILEPATH_0}}');

    return {
      args,
      cd: '$ROOTDIR',
      severity: 'error',
      outputs: [outputPath]
    };
  }
}
exports.default = Pweave;
Pweave.parameterTypes = [new _set2.default(['PythonNoWeb'])];
Pweave.description = 'Runs Pweave on Pnw files.';